# 数据源管理 - 产品需求文档（PRD）

## 一、功能概述

工业孪生平台需要从多类型、多协议的数据源中采集实时/准实时数据，并在此基础上建立工厂模型及数字孪生体系。为了保障数据可用性、可观测性及管理效率，本模块包括：

- **数据源注册与管理**
- **数据点位识别与管理**
- **数据源使用统计**
- **数据源状态监控**
- **数据异常规则定义与回传机制**

---

## 二、功能页面设计

### 📘 功能页面一：数据源管理页面

#### 2.1 数据源注册

**目的**：接入工业现场的 OT/IT 数据源（如 OPC UA、Modbus、数据库、REST API 等）。

**关键字段**：

| 字段名称 | 类型 | 说明 |
|---------|------|------|
| 数据源名称 | 文本 | 自定义命名 |
| 数据源类型 | 枚举 | OPC UA / Modbus / SQL / API |
| 通信协议 | 枚举 | OPC DA / OPC UA / MQTT 等 |
| 接入方式 | 枚举 | 直连 / 通过网关 / 通过边缘代理 |
| IP/端口 | 文本 | 远程连接信息 |
| 认证方式 | 枚举 | 用户密码 / Token / 无认证 |
| 数据源标签 | 多选标签 | 可用于筛选与权限配置 |
| 所属组织/工厂 | 组织树 | 绑定工厂模型结构 |

**页面操作流程**：

1. 新增数据源 → 自动检测连通性 → 成功后保存配置
2. 可查看数据源详情、修改、停用、删除

#### 2.2 数据源状态监控

**目的**：实时感知数据源运行状态，预警通信异常。

**核心指标**：

| 指标 | 描述 |
|------|------|
| 通信状态 | 在线 / 离线 / 波动 |
| 数据更新频率 | 单位时间内上传数据条数 |
| 最近通信时间 | 最近一次成功采集时间 |
| 报错率 | 通信/认证/协议错误频次 |

**展示方式**：

- 数据源列表页提供状态指示灯
- 可切换图表趋势（每分钟采样）

#### 2.3 数据源使用统计

**目的**：评估各数据源对平台建模和计算服务的贡献与负载。

**关键统计指标**：

| 统计项 | 描述 |
|--------|------|
| 被哪些模型使用 | 引用该数据源的数字孪生模型列表 |
| 提供数据点位数量 | 所属点位数 |
| 平均日数据量 | 数据条目数 / 数据流量大小 |
| 被哪些页面引用 | 可视化看板 / 告警等引用关系 |

**应用价值**：

- 支持数据源优化（合并、下线冗余源）
- 分析平台资源消耗情况

---

### 📗 功能页面二：数据点位管理页面

#### 2.4 点位识别

**目的**：在数据源注册成功后，从数据源中自动或手动导入/识别数据点位。

**功能要点**：

| 功能 | 描述 |
|------|------|
| 自动扫描 | 选取数据源，扫描自动获取数据点位，包括数据点位名称、编码、数据点位描述、层级结构、数据类型等 |
| 点位字段完善 | 完善数据点位字段信息，如名称、描述、单位、精度等 |
| 点位分类 | 下拉多选，可自定义 |

#### 2.5 数据点位管理

**目标**：对已识别点位进行管理与标准化，为后续建模服务打好基础。

**核心字段**：

| 字段名称 | 类型 | 说明 |
|----------|------|------|
| 点位名称 | 文本 | 可配置为平台标准命名 |
| 原始点位名 | 文本 | 数据源中的原始名称 |
| 数据类型 | 枚举 | 整型 / 浮点 / 布尔 / 字符串等 |
| 单位 | 文本 | ℃、t/h、kWh等 |
| 更新时间周期 | 秒数 | 设定采集周期（建议值） |
| 是否启用 | 开关 | 决定是否启用该点位 |
| 是否参与建模 | 开关 | 决定是否供数字孪生使用 |

#### 2.6 异常规则定义与回传

**归属原因**：异常规则依赖点位的数值行为，与点位强关联，因此放在点位管理页下更合适。

**支持类型**：

| 规则类型 | 示例 |
|----------|------|
| 静态阈值判断 | 大于 X，小于 Y，区间外告警 |
| 波动率判断 | 单位时间内波动超过 X% 预警 |
| 趋势判断 | 连续上升 / 连续下降 N 次 |
| 间歇性丢数判断 | 连续未更新超过 X 秒 |

**回传机制**：

- 异常判断结果可写入"虚拟点位"
- 可推送到数据总线或报警模块
- 可触发看板高亮/通知

---

## 三、安全与权限控制

**适用于两页面的安全控制**：

| 项目 | 内容说明 |
|------|----------|
| 权限控制 | 按组织/用户角色配置查看、编辑、下发权限 |
| 日志审计 | 数据源/点位的注册、修改、删除均有审计日志 |
| 安全通信 | 支持加密认证、Token、TLS 等方式接入数据源 |

---

## 四、技术实现要点

### 4.1 数据源连接管理

- **连接池管理**：支持多数据源并发连接
- **重连机制**：网络异常时自动重连
- **负载均衡**：支持数据源负载分担

### 4.2 数据采集优化

- **批量采集**：减少网络传输开销
- **数据压缩**：支持数据压缩传输
- **缓存机制**：本地缓存减少重复请求

### 4.3 异常处理机制

- **超时处理**：设置合理的超时时间
- **错误重试**：失败时自动重试机制
- **降级策略**：异常时的降级处理方案

---

## 五、验收标准

### 5.1 功能验收

- [ ] 支持多种数据源类型接入
- [ ] 数据源状态实时监控
- [ ] 点位自动识别和批量导入
- [ ] 异常规则配置和回传
- [ ] 权限控制和审计日志

### 5.2 性能验收

- [ ] 数据源连接响应时间 < 5秒
- [ ] 点位数据采集延迟 < 1秒
- [ ] 支持1000+数据源并发连接
- [ ] 支持10000+点位同时监控

### 5.3 安全验收

- [ ] 数据传输加密
- [ ] 用户权限验证
- [ ] 操作日志完整记录
- [ ] 敏感信息脱敏处理