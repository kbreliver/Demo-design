# 工厂模型模板管理 PRD文档

## 1. 功能目标

### 1.1 工厂模型模板列表页面 (factory-model-templates.html)
- 提供工厂模型模板的统一展示和管理入口
- 支持模板的快速查找、筛选和分类浏览
- 实现模板的实例化创建和编辑操作
- 提供模板使用统计和状态管理

### 1.2 工厂模型模板管理页面 (factory-model-template-management.html)
- 提供模板基本信息的创建、编辑和管理功能
- 支持模板层级结构的可视化构建和编辑
- 实现节点级别的增删改查和拖拽排序
- 确保模板数据的完整性和一致性

## 2. 功能描述

### 2.1 工厂模型模板列表页面

#### 2.1.1 模板展示
- **搜索筛选区域**：支持按模板分类、发布状态进行筛选
- **统计卡片区域**：显示模板总数、已发布数量、未发布数量等关键指标
- **模板卡片展示**：以卡片形式展示模板基本信息，包括名称、描述、类型、状态等
- **操作按钮区域**：位于卡片底部，提供创建、编辑、删除、实例化等操作入口

#### 2.1.2 模板操作
- **创建自定义模板**：跳转到模板管理页面创建新模板
- **编辑模板**：跳转到模板管理页面编辑现有模板
- **创建工厂模型**：基于已发布的模板创建新的工厂模型实例
- **删除模板**：删除指定模板（需要确认）

#### 2.1.3 数据统计
- **节点数量统计**：显示模板包含的节点总数
- **实例化数量统计**：显示模板被使用的次数
- **复制数量统计**：显示模板被复制的次数

### 2.2 工厂模型模板管理页面

#### 2.2.1 页面头部
- **粘性定位**：页面头部在滚动时保持固定在顶部，确保操作按钮始终可见
- **页面标题**：显示当前页面标题"工厂模型模板管理"
- **操作按钮区域**：右侧显示实例化工厂模型、保存模板、返回列表等主要操作按钮
- **响应式布局**：在不同屏幕尺寸下自动调整布局，确保良好的用户体验

#### 2.2.2 基本信息管理
- **模板名称**：模板的标识名称
- **模板描述**：模板的详细说明
- **模板类型**：标准模板或自定义模板（只读字段）
- **发布状态**：已发布或未发布状态

#### 2.2.3 层级结构管理
- **树形结构展示**：以层级树形式展示模板结构
- **节点操作**：支持节点的添加、编辑、复制、删除
- **拖拽排序**：支持节点拖拽调整顺序和层级关系
- **展开收起**：支持树形结构的展开和收起操作

#### 2.2.4 节点管理
- **节点信息**：节点名称、类型、描述
- **节点类型**：集团、公司、工厂、产线、车间、工段、实验室、仓库、设备、其它
- **层级关系**：父子节点关系管理
- **操作权限**：根据节点层级和类型限制操作

## 3. 交互说明

### 3.1 工厂模型模板列表页面

#### 3.1.1 页面加载
- 页面加载时自动获取模板列表数据
- 显示统计卡片和筛选条件
- 渲染模板卡片列表

#### 3.1.2 搜索筛选
- 选择分类筛选条件，自动更新模板列表
- 选择状态筛选条件，自动更新模板列表
- 支持"全部"选项重置筛选条件

#### 3.1.3 模板操作
- 点击模板标题跳转到编辑页面
- 点击"创建工厂模型"按钮（仅已发布模板可用）确认后跳转到工厂模型管理页面
- 点击编辑按钮跳转到模板管理页面
- 点击删除按钮弹出确认对话框
- 点击复制按钮弹出确认对话框，确认后跳转到模板管理页面进行复制编辑

#### 3.1.4 创建模板
- 点击"创建自定义模板"按钮跳转到模板管理页面
- 自动设置action=create参数标识新建模式
- 新建模板自动设置为"自定义模板"类型
- 新建模板的层级结构初始化为空

### 3.2 工厂模型模板管理页面

#### 3.2.1 页面初始化
- 根据URL参数判断是新建、编辑还是复制模式
- 新建模式：初始化空模板和空层级结构，自动设置为"自定义模板"类型
- 编辑模式：加载现有模板数据和层级结构
- 复制模式：加载复制的模板数据，自动设置为"自定义模板"类型，复制层级结构并重新生成节点ID
- 页面头部采用粘性定位，在滚动时保持固定在顶部

#### 3.2.2 基本信息编辑
- 实时编辑模板名称、描述、状态
- 模板类型字段为只读，显示当前模板类型
- 表单验证确保必填字段完整性
- 自动保存或手动保存更改

#### 3.2.3 层级结构操作
- 点击"添加子节点"按钮打开节点编辑抽屉
- 点击节点操作按钮（编辑、复制、删除）执行相应操作
- 拖拽节点调整位置和层级关系
- 点击展开/收起图标控制节点显示

#### 3.2.4 节点编辑
- 右侧抽屉形式编辑节点信息
- 表单验证节点名称、类型、描述
- 支持取消和确认操作
- 点击抽屉外区域自动关闭

#### 3.2.5 拖拽操作
- 拖拽节点时显示拖拽状态
- 同层级拖拽调整顺序
- 跨层级拖拽需要确认操作
- 防止无效的拖拽操作（如父节点拖到子节点）

## 4. 字段说明

### 4.1 模板基本信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 模板唯一标识 | template_1234567890 |
| name | String | 是 | 模板名称 | 水泥工厂标准模板 |
| description | String | 是 | 模板描述 | 针对水泥行业特点，包含原料处理、烧成、粉磨等核心工艺环节 |
| category | String | 是 | 模板类型 | standard/custom |
| categoryDisplay | String | 是 | 模板类型显示名称 | 标准模板/自定义模板 |
| status | String | 是 | 发布状态 | published/unpublished |
| createTime | String | 是 | 创建时间 | 2024-01-20 |
| instanceCount | Number | 否 | 实例化数量 | 5 |
| copyCount | Number | 否 | 复制数量 | 2 |

### 4.2 节点信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 节点唯一标识 | node_1234567890 |
| name | String | 是 | 节点名称 | 水泥工厂 |
| type | String | 是 | 节点类型 | 工厂 |
| description | String | 是 | 节点描述 | 水泥生产工厂 |
| level | Number | 是 | 节点层级 | 1 |
| parentId | String | 否 | 父节点ID | null |

### 4.3 节点类型枚举

| 类型值 | 显示名称 | 图标 | 说明 |
|--------|----------|------|------|
| 集团 | 集团 | el-icon-office-building | 企业集团级别 |
| 公司 | 公司 | el-icon-office-building | 公司级别 |
| 工厂 | 工厂 | el-icon-office-building | 工厂级别 |
| 产线 | 产线 | el-icon-s-operation | 生产线级别 |
| 车间 | 车间 | el-icon-s-shop | 车间级别 |
| 工段 | 工段 | el-icon-s-operation | 工段级别 |
| 实验室 | 实验室 | el-icon-s-home | 实验室级别 |
| 仓库 | 仓库 | el-icon-s-home | 仓库级别 |
| 设备 | 设备 | el-icon-s-platform | 设备级别 |
| 其它 | 其它 | el-icon-s-help | 其他类型 |

## 5. 业务规则

### 5.1 模板管理规则

#### 5.1.1 模板创建规则
- 新建模板时层级结构必须为空
- 新建模板自动设置为"自定义模板"类型
- 模板名称不能重复
- 模板描述不能为空
- 新建模板默认状态为"未发布"

#### 5.1.2 模板编辑规则
- 已发布的模板可以编辑，但需要重新发布
- 模板类型字段为只读，不可修改
- 删除模板前需要确认，删除后不可恢复

#### 5.1.3 模板使用规则
- 只有已发布的模板可以被实例化
- 未发布的模板的"创建工厂模型"按钮会被禁用，并显示提示信息
- 实例化操作会增加模板的使用计数
- 复制模板会创建新的模板副本，自动设置为"自定义模板"类型
- 复制模板会跳转到模板管理页面进行编辑
- 页面头部提供实例化工厂模型的快速入口，提升操作效率

### 5.2 层级结构规则

#### 5.2.1 节点创建规则
- 每个模板只能有一个根节点
- 根节点必须是level=1的节点
- 子节点的level必须比父节点大1
- 节点名称在同一父节点下不能重复

#### 5.2.2 节点类型规则
- 根节点通常为"集团"、"公司"或"工厂"类型
- 设备节点通常作为叶子节点
- 节点类型选择需要符合业务逻辑

#### 5.2.3 节点操作规则
- 删除节点会同时删除其所有子节点
- 复制节点会复制该节点及其所有子节点
- 拖拽操作不能形成循环引用
- 父节点不能拖拽到子节点下

### 5.3 数据验证规则

#### 5.3.1 表单验证
- 模板名称：必填，长度1-50字符
- 模板描述：必填，长度1-500字符
- 节点名称：必填，长度1-50字符
- 节点描述：必填，长度1-200字符
- 节点类型：必填，从预定义类型中选择

#### 5.3.2 业务验证
- 模板保存前必须至少有一个根节点
- 节点层级不能超过5层
- 同一父节点下不能有重复的节点名称
- 拖拽操作需要验证层级关系的合理性

### 5.4 权限控制规则

#### 5.4.1 操作权限
- 标准模板只能查看，不能编辑（除非有特殊权限）
- 自定义模板可以完全编辑
- 模板类型字段对所有模板都是只读的
- 删除操作需要二次确认
- 发布操作需要验证模板完整性
- 只有已发布的模板才能进行实例化操作

#### 5.4.2 数据权限
- 用户只能看到有权限的模板
- 模板数据变更需要记录操作日志
- 重要操作需要记录操作人和操作时间

### 5.5 性能规则

#### 5.5.1 数据加载
- 模板列表支持分页加载
- 层级结构支持懒加载
- 大量节点时支持虚拟滚动

#### 5.5.2 操作响应
- 拖拽操作需要防抖处理
- 保存操作需要显示加载状态
- 删除操作需要异步处理