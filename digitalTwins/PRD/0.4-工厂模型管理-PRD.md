# 工厂模型管理 PRD文档

## 1. 功能目标

### 1.1 工厂模型实例化功能
- 从工厂模型模板实例化工厂模型实例，复制模板中的层级结构
- 提供模板选择和实例化配置功能
- 支持实例化参数的设置和验证

### 1.2 工厂模型管理页面 (factory-model-management.html)
-编辑工厂模型的基本信息：名称、描述，并显示来源模版信息（只读）
- 提供工厂模型实例的层级结构管理功能，支持节点的增删改查和拖拽排序操作（功能请工厂模型模板中的层级结构管理）
- 实现资产实例的挂载、配置和管理
- 提供权限控制、数据归属和数据访问控制
- 支持节点的搜索功能

### 1.3 工厂模型列表管理页面
- 支持工厂实例的列表管理
- 提供工厂实例的搜索和筛选功能
- 支持工厂实例的导出导入功能
- 支持工厂实例的启用控制

## 2. 功能描述

### 2.1 工厂模型实例化功能

#### 2.1.1 实例化配置
- **实例基本信息**：配置工厂模型实例的名称、描述
- **层级结构预览**：预览将要复制的层级结构

#### 2.1.2 实例化执行
- **层级结构复制**：从模板复制完整的层级结构到实例，并填写实例化的名称和描述
- **节点ID重新生成**：为复制的节点生成新的唯一标识
- **实例创建确认**：确认实例化操作并创建工厂模型实例

### 2.2 工厂模型管理页面

#### 2.2.1 页面头部
- **粘性定位**：页面头部在滚动时保持固定在顶部，确保操作按钮始终可见
- **页面标题**：显示当前工厂模型实例名称和描述
- **操作按钮区域**：右侧显示保存、导出、启用/禁用、返回列表等主要操作按钮
- **响应式布局**：在不同屏幕尺寸下自动调整布局，确保良好的用户体验

#### 2.2.2 基本信息管理
- **工厂模型名称**：工厂模型实例的标识名称
- **工厂模型描述**：工厂模型实例的详细说明
- **来源模板**：显示基于哪个模板创建的实例
- **创建时间**：工厂模型实例的创建时间
- **启用状态**：启用或禁用状态
- **创建人**：创建该工厂模型实例的用户

#### 2.2.3 层级结构管理
- **树形结构展示**：以层级树形式展示工厂模型结构（从模板复制）
- **节点操作**：支持节点的添加、编辑、复制、删除
- **拖拽排序**：支持节点拖拽调整顺序和层级关系
- **展开收起**：支持树形结构的展开和收起操作
- **搜索功能**：支持节点的搜索和定位

#### 2.2.4 资产实例挂载
- **资产挂载**：为层级结构的各个节点挂载资产实例，一个节点可以挂载多个资产实例。一个资产实例只能挂载到一个节点下。
- **资产配置**：可配置资产实例的属性值、变量、描述等信息
- **资产管理**：支持资产的挂载、卸载、编辑等操作
- **资产列表**：显示节点下挂载的所有资产实例
- **资产详情**：查看和编辑资产实例的详细信息

#### 2.2.5 权限控制
- **节点权限**：对层级结构的各个节点进行权限控制
- **数据归属**：控制数据归属和访问权限
- **数据访问控制**：基于用户角色和权限控制数据访问
- **操作权限**：根据用户权限限制节点和资产的操作

### 2.3 工厂模型列表管理页面

#### 2.3.1 列表展示
- **工厂实例列表**：以表格形式展示所有工厂模型实例
- **基本信息展示**：显示实例名称、描述、来源模板、创建时间等
- **状态显示**：显示实例的启用状态和资产挂载数量
- **操作按钮**：提供编辑、删除、启用/禁用等操作入口

#### 2.3.2 搜索筛选
- **关键词搜索**：支持实例名称、描述的模糊搜索
- **状态筛选**：按启用状态进行筛选
- **模板筛选**：按来源模板进行筛选
- **时间筛选**：按创建时间范围进行筛选

#### 2.3.3 批量操作
- **批量启用**：批量启用选中的工厂实例
- **批量禁用**：批量禁用选中的工厂实例
- **批量导出**：批量导出选中的工厂实例

## 3. 交互说明

### 3.1 工厂模型实例化页面

#### 3.1.1 页面加载
- 页面加载时自动获取可用的工厂模型模板列表
- 显示模板筛选条件和搜索框
- 渲染模板列表，支持分页加载

#### 3.1.2 模板选择
- 点击模板卡片查看模板详细信息
- 选择模板后显示层级结构预览
- 支持模板的搜索和筛选操作

#### 3.1.3 实例化配置
- 填写工厂模型实例的基本信息
- 配置实例化相关参数
- 预览将要复制的层级结构
- 验证配置参数的完整性

#### 3.1.4 实例化执行
- 点击"创建实例"按钮开始实例化
- 显示实例化进度和状态
- 实例化完成后跳转到工厂模型管理页面

### 3.2 工厂模型管理页面

#### 3.2.1 页面初始化
- 根据URL参数加载工厂模型实例数据
- 从模板复制层级结构到实例中
- 初始化资产挂载状态和权限控制
- 页面头部采用粘性定位，在滚动时保持固定在顶部

#### 3.2.2 基本信息编辑
- 实时编辑工厂模型名称、描述、启用状态
- 显示来源模板信息（只读）
- 表单验证确保必填字段完整性
- 页面头部操作按钮支持快速保存和返回操作

#### 3.2.3 层级结构操作
- 基于模板的层级结构进行节点操作
- 支持节点的添加、编辑、复制、删除
- 拖拽节点调整位置和层级关系
- 点击展开/收起图标控制节点显示
- 支持节点搜索和定位功能

#### 3.2.4 资产实例挂载
- 点击节点挂载资产按钮打开资产选择对话框
- 选择资产实例并配置属性值、变量、描述等信息
- 支持资产的挂载、卸载、编辑操作
- 显示节点下挂载的资产列表
- 点击资产查看详细信息

#### 3.2.5 权限控制操作
- 设置节点级别的权限控制
- 配置数据归属和访问权限
- 基于用户角色控制数据访问
- 权限变更需要确认操作

#### 3.2.6 工厂实例管理操作
- 支持工厂实例的保存和导出
- 启用/禁用工厂实例
- 返回工厂实例列表
- 支持实例的搜索和筛选

### 3.3 工厂模型列表管理页面

#### 3.3.1 页面加载
- 页面加载时自动获取工厂模型实例列表
- 显示搜索筛选条件和操作按钮
- 渲染实例列表，支持分页加载

#### 3.3.2 搜索筛选
- 输入关键词进行模糊搜索
- 选择筛选条件自动更新列表
- 支持多条件组合筛选
- 提供筛选条件重置功能

#### 3.3.3 实例操作
- 点击实例行进入编辑页面
- 点击操作按钮执行相应操作
- 支持批量选择和批量操作
- 删除操作需要二次确认

#### 3.3.4 导出导入
- 选择实例进行导出操作
- 支持导出格式选择（JSON、Excel等）
- 导入实例文件进行批量创建
- 导入过程中显示进度和结果

## 4. 字段说明

### 4.1 工厂模型实例基本信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 工厂模型实例唯一标识 | factory_1234567890 |
| name | String | 是 | 工厂模型实例名称 | 华新水泥工厂 |
| description | String | 是 | 工厂模型实例描述 | 华新水泥集团下属工厂实例 |
| templateId | String | 是 | 来源模板ID | template_1234567890 |
| templateName | String | 是 | 来源模板名称 | 水泥工厂标准模板 |
| createTime | String | 是 | 创建时间 | 2024-01-20 |
| createUser | String | 是 | 创建人 | admin |
| status | String | 是 | 启用状态 | enabled/disabled |
| assetCount | Number | 否 | 挂载资产数量 | 25 |

### 4.2 节点信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 节点唯一标识 | node_1234567890 |
| name | String | 是 | 节点名称 | 水泥工厂 |
| type | String | 是 | 节点类型 | 工厂 |
| description | String | 是 | 节点描述 | 水泥生产工厂 |
| level | Number | 是 | 节点层级 | 1 |
| parentId | String | 否 | 父节点ID | null |

### 4.3 节点类型枚举

| 类型值 | 显示名称 | 图标 | 说明 |
|--------|----------|------|------|
| 集团 | 集团 | el-icon-office-building | 企业集团级别 |
| 公司 | 公司 | el-icon-office-building | 公司级别 |
| 工厂 | 工厂 | el-icon-office-building | 工厂级别 |
| 产线 | 产线 | el-icon-s-operation | 生产线级别 |
| 车间 | 车间 | el-icon-s-shop | 车间级别 |
| 工段 | 工段 | el-icon-s-operation | 工段级别 |
| 实验室 | 实验室 | el-icon-s-home | 实验室级别 |
| 仓库 | 仓库 | el-icon-s-home | 仓库级别 |
| 设备 | 设备 | el-icon-s-platform | 设备级别 |
| 其它 | 其它 | el-icon-s-help | 其他类型 |

### 4.4 资产实例挂载字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 资产实例唯一标识 | asset_1234567890 |
| name | String | 是 | 资产实例名称 | 破碎机001 |
| type | String | 是 | 资产类型 | 设备 |
| nodeId | String | 是 | 挂载节点ID | node_1234567890 |
| nodeName | String | 是 | 挂载节点名称 | 破碎工段 |
| properties | Object | 否 | 资产属性值 | {功率: "100kW", 转速: "1500rpm"} |
| variables | Array | 否 | 资产变量列表 | [{name: "温度", value: "85℃"}] |
| description | String | 否 | 资产描述 | 石灰石破碎设备 |
| mountTime | String | 是 | 挂载时间 | 2024-01-20 10:30:00 |
| mountUser | String | 是 | 挂载人 | admin |

### 4.5 权限控制字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| nodeId | String | 是 | 节点ID | node_1234567890 |
| userId | String | 是 | 用户ID | user_1234567890 |
| role | String | 是 | 用户角色 | admin/operator/viewer |
| permissions | Array | 是 | 权限列表 | ["read", "write", "delete"] |
| dataOwnership | String | 是 | 数据归属 | department_001 |
| accessControl | Object | 否 | 访问控制规则 | {timeRange: "9:00-18:00"} |

## 5. 业务规则

### 5.1 实例化规则

#### 5.1.1 模板选择规则
- 只能选择已发布的模板进行实例化
- 模板必须包含完整的层级结构
- 支持模板的预览和详细信息查看

#### 5.1.2 实例化配置规则
- 工厂模型实例名称不能重复
- 实例描述不能为空
- 实例化参数必须完整配置
- 支持实例化参数的验证和预览

#### 5.1.3 实例化执行规则
- 实例化过程中会完整复制模板的层级结构
- 为复制的节点生成新的唯一标识
- 实例化完成后自动跳转到管理页面
- 记录实例化操作日志

### 5.2 层级结构管理规则

#### 5.2.1 节点创建规则
- 每个工厂模型实例只能有一个根节点
- 根节点必须是level=1的节点
- 子节点的level必须比父节点大1
- 节点名称在同一父节点下不能重复

#### 5.2.2 节点操作规则
- 删除节点会同时删除其所有子节点和挂载的资产
- 复制节点会复制该节点及其所有子节点
- 拖拽操作不能形成循环引用
- 父节点不能拖拽到子节点下

#### 5.2.3 节点搜索规则
- 支持节点名称的模糊搜索
- 支持节点类型的精确搜索
- 搜索结果高亮显示
- 支持搜索结果的快速定位

### 5.3 资产挂载规则

#### 5.3.1 资产挂载规则
- 只能为叶子节点挂载资产实例
- 一个节点可以挂载多个资产实例
- 资产实例挂载时需要配置必要的属性值
- 卸载资产实例需要确认操作

#### 5.3.2 资产配置规则
- 资产属性值必须符合数据类型要求
- 资产变量列表支持动态配置
- 资产描述不能为空
- 资产配置变更需要记录操作日志

#### 5.3.3 资产管理规则
- 支持资产的挂载、卸载、编辑操作
- 资产列表支持分页显示
- 支持资产的批量操作
- 资产详情支持完整的CRUD操作

### 5.4 权限控制规则

#### 5.4.1 节点权限规则
- 基于用户角色控制节点操作权限
- 支持节点级别的权限继承
- 权限变更需要管理员确认
- 权限控制支持细粒度配置

#### 5.4.2 数据归属规则
- 数据归属基于组织架构设置
- 支持数据归属的继承和覆盖
- 数据归属变更需要审批流程
- 数据归属影响数据访问权限

#### 5.4.3 访问控制规则
- 支持时间范围和IP限制
- 支持用户角色的动态配置
- 访问控制规则支持优先级设置
- 访问控制变更需要记录日志

### 5.5 工厂实例管理规则

#### 5.5.1 实例状态规则
- 支持工厂实例的启用和禁用控制
- 禁用的实例不能进行资产挂载操作
- 实例状态变更需要确认操作
- 状态变更需要记录操作日志

#### 5.5.2 导出导入规则
- 支持实例的完整导出和导入
- 导出格式支持JSON和Excel
- 导入过程中进行数据验证
- 导入冲突需要用户确认处理

#### 5.5.3 列表管理规则
- 实例列表支持分页和排序
- 支持多条件组合搜索和筛选
- 支持批量操作和批量选择
- 删除操作需要二次确认

### 5.6 数据验证规则

#### 5.6.1 表单验证
- 工厂模型名称：必填，长度1-50字符
- 工厂模型描述：必填，长度1-500字符
- 节点名称：必填，长度1-50字符
- 节点描述：必填，长度1-200字符
- 资产名称：必填，长度1-50字符

#### 5.6.2 业务验证
- 工厂模型实例保存前必须至少有一个根节点
- 节点层级不能超过5层
- 同一父节点下不能有重复的节点名称
- 资产挂载前必须验证节点类型

### 5.7 性能规则

#### 5.7.1 数据加载
- 工厂实例列表支持分页加载
- 层级结构支持懒加载
- 大量节点时支持虚拟滚动
- 资产列表支持分页显示

#### 5.7.2 操作响应
- 拖拽操作需要防抖处理
- 保存操作需要显示加载状态
- 删除操作需要异步处理
- 资产挂载操作需要实时反馈

### 5.8 用户体验规则

#### 5.8.1 页面布局
- 页面头部采用粘性定位，滚动时保持固定在顶部
- 操作按钮始终可见，提升操作便利性
- 响应式设计适配不同屏幕尺寸
- 页面滚动时保持操作连续性

#### 5.8.2 交互优化
- 页面头部操作按钮提供快速访问主要功能
- 滚动过程中保持关键操作的可访问性
- 支持键盘快捷键操作
- 提供操作反馈和状态提示
- 资产挂载操作提供可视化界面
- 权限控制操作提供直观的权限矩阵 