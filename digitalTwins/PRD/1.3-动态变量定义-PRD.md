# 动态变量定义 - 产品需求文档

## 1. 功能描述

### 1.1 动态变量列表管理
- **功能描述**：展示和管理资产类型的所有动态变量，支持批量操作和单个操作
- **主要功能**：
  - 动态变量列表展示
  - 变量信息查看
  - 批量选择操作
  - 单个变量编辑和删除

### 1.2 新增动态变量
- **功能描述**：通过表单方式新增动态变量，定义变量的各项属性
- **主要功能**：
  - 变量基本信息录入
  - 数据类型和分类设置
  - 采集参数配置
  - 验证规则定义

### 1.3 编辑动态变量
- **功能描述**：修改已存在的动态变量信息
- **主要功能**：
  - 复用新增变量模态框
  - 自动填充现有数据
  - 支持所有字段修改

### 1.4 删除动态变量
- **功能描述**：删除不需要的动态变量
- **主要功能**：
  - 单个变量删除
  - 删除确认提示
  - 批量删除支持

### 1.5 引用变量组
- **功能描述**：通过引用预定义的变量组来批量添加变量
- **主要功能**：
  - 变量组搜索和选择
  - 多选变量组
  - 自动设置所属变量组
  - 仅显示动态变量类别

## 2. 交互说明

### 2.1 动态变量列表操作
1. **查看列表**：进入"动态变量模板"页面，自动显示当前资产类型的所有动态变量
2. **全选操作**：点击表头复选框可全选/取消全选所有变量
3. **单个选择**：点击每行的复选框可选择单个变量
4. **编辑变量**：点击"编辑"按钮打开编辑模态框
5. **删除变量**：点击"删除"按钮，确认后删除变量

### 2.2 新增变量操作
1. **打开新增模态框**：点击"新增变量"按钮
2. **填写基本信息**：输入变量名称、编码等必填信息
3. **设置数据类型**：选择数值、字符串、布尔值、枚举、日期、日期时间
4. **选择变量分类**：选择实时数据、累计数据、状态数据、计算数据
5. **配置采集参数**：设置单位、精度、取值范围、采集频率
6. **保存变量**：点击"保存"按钮完成新增

### 2.3 编辑变量操作
1. **打开编辑模态框**：点击变量列表中的"编辑"按钮
2. **查看现有数据**：模态框自动填充当前变量的所有信息
3. **修改字段值**：根据需要修改各个字段
4. **保存修改**：点击"保存"按钮更新变量信息

### 2.4 引用变量组操作
1. **打开变量组选择器**：点击"引用变量组"按钮
2. **搜索变量组**：在搜索框中输入关键词进行搜索
3. **选择变量组**：勾选需要引用的变量组（支持多选）
4. **确认引用**：点击"确定引用"按钮完成引用
5. **自动设置**：引用后新增变量会自动设置所属变量组

## 3. 字段说明

### 3.1 变量列表字段

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 序号 | 数字 | 是 | 变量的显示顺序，自动生成 |
| 变量名称 | 文本 | 是 | 变量名称，用于显示 |
| 变量编码 | 文本 | 是 | 变量的唯一标识符，用于系统识别 |
| 数据类型 | 枚举 | 是 | 支持：数值、字符串、布尔值、枚举、日期、日期时间 |
| 变量分类 | 枚举 | 是 | 支持：实时数据、累计数据、状态数据、计算数据 |
| 所属变量组 | 文本 | 否 | 变量所属的变量组名称，由引用变量组功能决定 |
| 单位 | 文本 | 否 | 变量的计量单位，如：℃、MPa、小时等 |
| 精度 | 数字 | 否 | 数值类型变量的精度，如：0.1、0.01等 |
| 采集频率 | 枚举 | 是 | 数据采集的时间间隔 |
| 描述 | 文本 | 否 | 变量的详细说明信息 |

### 3.2 变量定义表单字段

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 变量名称 | 文本输入 | 是 | 变量名称，最大长度50字符 |
| 变量编码 | 文本输入 | 是 | 变量的唯一标识符，支持字母、数字、下划线 |
| 数据类型 | 下拉选择 | 是 | 选择变量的数据类型 |
| 变量分类 | 下拉选择 | 是 | 选择变量的业务分类 |
| 所属变量组 | 下拉选择 | 否 | 不可编辑，由引用变量组功能自动设置 |
| 单位 | 文本输入 | 否 | 变量的计量单位 |
| 精度 | 数字输入 | 否 | 数值精度，支持小数 |
| 取值范围 | 文本输入 | 否 | 数值范围或枚举选项 |
| 采集频率 | 下拉选择 | 是 | 选择数据采集频率 |
| 描述 | 文本域 | 否 | 变量的详细描述信息 |

### 3.3 采集频率选项

| 选项值 | 显示文本 | 说明 |
|--------|----------|------|
| 1s | 1秒 | 每秒采集一次 |
| 5s | 5秒 | 每5秒采集一次 |
| 10s | 10秒 | 每10秒采集一次 |
| 30s | 30秒 | 每30秒采集一次 |
| 1m | 1分钟 | 每分钟采集一次 |
| 5m | 5分钟 | 每5分钟采集一次 |
| 10m | 10分钟 | 每10分钟采集一次 |
| 1h | 1小时 | 每小时采集一次 |
| 1d | 1天 | 每天采集一次 |

### 3.4 变量分类说明

| 分类名称 | 分类编码 | 说明 | 示例 |
|----------|----------|------|------|
| 实时数据 | realtime | 设备运行过程中的实时监测数据 | 温度、压力、流量 |
| 累计数据 | cumulative | 设备运行过程中的累计统计数据 | 运行时间、产量、能耗 |
| 状态数据 | status | 设备运行状态相关的数据 | 开关状态、运行模式 |
| 计算数据 | calculated | 通过计算得出的派生数据 | 效率、利用率 |

### 3.5 预定义变量组

| 变量组名称 | 变量数量 | 描述 | 包含变量示例 |
|------------|----------|------|-------------|
| 温度监控组 | 3个 | 包含设备温度相关的监控变量 | 设备温度、环境温度、冷却水温度 |
| 压力监控组 | 4个 | 包含设备压力相关的监控变量 | 运行压力、系统压力、油压、气压 |
| 运行状态组 | 5个 | 包含设备运行状态相关的变量 | 设备状态、运行模式、开关状态、故障状态、维护状态 |
| 累计数据组 | 6个 | 包含设备累计运行数据 | 累计运行时间、累计产量、累计能耗、累计维护次数、累计故障次数、累计停机时间 |
| 效率计算组 | 4个 | 包含设备效率相关的计算变量 | 运行效率、产能利用率、设备可用率、综合效率 |

## 4. 业务规则

### 4.1 变量编码规则
- 变量编码必须唯一，不能与现有变量重复
- 支持字母、数字、下划线组合
- 建议使用英文命名，便于系统处理

### 4.2 数据类型规则
- 数值类型：支持整数和小数，可设置精度
- 字符串类型：支持任意文本内容
- 布尔值类型：仅支持true/false或0/1
- 枚举类型：需要定义具体的选项值
- 日期类型：支持日期格式
- 日期时间类型：支持日期时间格式

### 4.3 所属变量组规则
- 所属变量组字段不可手动编辑
- 只能通过"引用变量组"功能自动设置
- 一个变量可以属于一个变量组
- 引用变量组后，新增的变量会自动设置所属变量组

### 4.4 采集频率规则
- 采集频率是必填字段
- 频率选择影响数据存储和查询性能
- 建议根据数据变化频率选择合适的采集频率 