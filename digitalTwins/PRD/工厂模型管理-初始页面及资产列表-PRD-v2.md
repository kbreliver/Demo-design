# 工厂模型管理 - 初始页面及资产列表 PRD文档

## 1. 功能目标

### 1.1 工厂模型管理初始页面
- 提供工厂模型实例的层级结构管理功能
- 支持节点的增删改查和拖拽排序操作
- 实现资产实例的挂载、配置和管理
- 提供权限控制、数据归属和数据访问控制
- 支持节点的搜索功能

### 1.2 资产列表管理
- 支持资产实例的列表展示和管理
- 提供资产的挂载、卸载、编辑等操作
- 支持资产配置的批量操作
- 实现资产数据的实时绑定和更新

## 2. 功能描述

### 2.1 页面头部设计
- **粘性定位**：页面头部在滚动时保持固定在顶部，确保操作按钮始终可见
- **页面标题**：显示当前工厂模型实例名称和描述
- **操作按钮区域**：右侧显示保存、导出、启用/禁用、返回列表等主要操作按钮
- **响应式布局**：在不同屏幕尺寸下自动调整布局，确保良好的用户体验

### 2.2 层级结构管理
- **树形结构展示**：以层级树形式展示工厂模型结构（从模板复制）
- **节点操作**：支持节点的添加、编辑、复制、删除
- **拖拽排序**：支持节点拖拽调整顺序和层级关系
- **展开收起**：支持树形结构的展开和收起操作
- **搜索功能**：支持节点的搜索和定位

### 2.3 资产实例挂载
- **资产挂载**：为层级结构的各个节点挂载资产实例，一个节点可以挂载多个资产实例
- **资产配置**：可配置资产实例的属性值、变量、描述等信息
- **资产管理**：支持资产的挂载、卸载、编辑等操作
- **资产列表**：显示节点下挂载的所有资产实例
- **资产详情**：查看和编辑资产实例的详细信息

## 3. 交互说明

### 3.1 页面初始化
- 根据URL参数加载工厂模型实例数据
- 从模板复制层级结构到实例中
- 初始化资产挂载状态和权限控制
- 页面头部采用粘性定位，在滚动时保持固定在顶部

### 3.2 层级结构操作
- 基于模板的层级结构进行节点操作
- 支持节点的添加、编辑、复制、删除
- 拖拽节点调整位置和层级关系
- 点击展开/收起图标控制节点显示
- 支持节点搜索和定位功能

### 3.3 资产实例挂载
- 点击节点挂载资产按钮打开资产选择对话框
- 选择资产实例并配置属性值、变量、描述等信息
- 支持资产的挂载、卸载、编辑操作
- 显示节点下挂载的资产列表
- 点击资产查看详细信息

## 4. 业务规则

### 4.1 层级结构管理规则
- 每个工厂模型实例只能有一个根节点
- 根节点必须是level=1的节点
- 子节点的level必须比父节点大1
- 节点名称在同一父节点下不能重复

### 4.2 节点操作规则
- 删除节点会同时删除其所有子节点和挂载的资产
- 复制节点会复制该节点及其所有子节点
- 拖拽操作不能形成循环引用
- 父节点不能拖拽到子节点下

### 4.3 资产挂载规则
- 只能为叶子节点挂载资产实例
- 一个节点可以挂载多个资产实例
- 资产实例挂载时需要配置必要的属性值
- 卸载资产实例需要确认操作

### 4.4 权限控制规则
- 基于用户角色控制节点操作权限
- 支持节点级别的权限继承
- 权限变更需要管理员确认
- 权限控制支持细粒度配置

## 5. 前置条件

### 5.1 系统前置条件
- 工厂模型模板已创建并发布
- 资产类型已定义并配置
- 用户权限已配置
- 数据源已配置并连接

### 5.2 数据前置条件
- 工厂模型实例已从模板实例化
- 层级结构已从模板复制
- 资产实例已创建
- 权限配置已初始化

### 5.3 用户前置条件
- 用户已登录系统
- 用户具有工厂模型管理权限
- 用户具有资产管理权限
- 用户具有数据访问权限

## 6. 字段说明

### 6.1 工厂模型实例基本信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 工厂模型实例唯一标识 | factory_1234567890 |
| name | String | 是 | 工厂模型实例名称 | 华新水泥工厂 |
| description | String | 是 | 工厂模型实例描述 | 华新水泥集团下属工厂实例 |
| templateId | String | 是 | 来源模板ID | template_1234567890 |
| templateName | String | 是 | 来源模板名称 | 水泥工厂标准模板 |
| createTime | String | 是 | 创建时间 | 2024-01-20 |
| createUser | String | 是 | 创建人 | admin |
| status | String | 是 | 启用状态 | enabled/disabled |
| assetCount | Number | 否 | 挂载资产数量 | 25 |

### 6.2 节点信息字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 节点唯一标识 | node_1234567890 |
| name | String | 是 | 节点名称 | 水泥工厂 |
| type | String | 是 | 节点类型 | 工厂 |
| description | String | 是 | 节点描述 | 水泥生产工厂 |
| level | Number | 是 | 节点层级 | 1 |
| parentId | String | 否 | 父节点ID | null |
| children | Array | 否 | 子节点列表 | [] |
| assetCount | Number | 否 | 挂载资产数量 | 5 |

### 6.3 资产实例挂载字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 资产实例唯一标识 | asset_1234567890 |
| name | String | 是 | 资产实例名称 | 破碎机001 |
| type | String | 是 | 资产类型 | 设备 |
| nodeId | String | 是 | 挂载节点ID | node_1234567890 |
| nodeName | String | 是 | 挂载节点名称 | 破碎工段 |
| properties | Object | 否 | 资产属性值 | {功率: "100kW", 转速: "1500rpm"} |
| variables | Array | 否 | 资产变量列表 | [{name: "温度", value: "85℃"}] |
| description | String | 否 | 资产描述 | 石灰石破碎设备 |
| mountTime | String | 是 | 挂载时间 | 2024-01-20 10:30:00 |
| mountUser | String | 是 | 挂载人 | admin |
| status | String | 是 | 资产状态 | active/inactive | 