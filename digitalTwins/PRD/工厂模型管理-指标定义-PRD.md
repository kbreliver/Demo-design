# 工厂模型管理 - 指标定义 PRD文档

## 1. 功能目标

### 1.1 指标定义管理
- 提供资产类型指标定义的配置和管理功能
- 支持指标参数的实时编辑和验证
- 实现指标配置的批量操作和导入导出
- 提供指标公式的配置和计算功能

### 1.2 指标配置
- 支持指标分类、方向、单位等参数配置
- 提供指标公式的多种输入模式
- 实现指标数据的实时计算和监控
- 支持指标的历史数据和趋势分析

## 2. 功能描述

### 2.1 指标列表
- **指标名称**：显示和编辑指标的标识名称
- **指标编码**：显示和编辑指标的唯一编码
- **指标分类**：支持性能指标、经济指标、安全指标、环保指标等分类
- **指标方向**：标识指标的正向或负向特性
- **单位**：支持指标的计量单位配置

### 2.2 指标配置
- **指标描述**：提供指标的详细说明和用途描述
- **计算公式**：支持指标的计算公式配置
- **数据来源**：配置指标计算所需的数据来源
- **计算频率**：设置指标的计算频率和更新周期

### 2.3 公式配置功能
- **自然语言输入**：支持自然语言描述的计算公式
- **可视化输入**：提供拖拽式的公式构建界面
- **表达式输入**：支持数学表达式的直接输入
- **公式验证**：实时验证公式的正确性和完整性

### 2.4 批量操作功能
- **批量编辑**：支持批量编辑指标参数
- **批量删除**：支持批量删除选中的指标
- **批量导入**：支持从外部文件批量导入指标
- **批量导出**：支持将指标配置导出到外部文件

## 3. 交互说明

### 3.1 页面加载
- 页面加载时根据选择的资产类型加载指标列表
- 初始化指标配置表单和验证规则
- 加载可用的数据源和变量
- 设置表格的编辑模式和显示模式

### 3.2 指标配置操作
- 点击新增指标按钮打开指标配置对话框
- 支持指标的实时编辑和验证
- 提供指标配置的保存和取消操作
- 支持指标配置的复制和删除

### 3.3 公式配置操作
- 选择公式输入模式（自然语言、可视化、表达式）
- 支持公式的实时编辑和验证
- 提供公式的测试和预览功能
- 支持公式的保存和版本管理

### 3.4 批量操作
- 选择多个指标进行批量操作
- 支持批量编辑指标参数
- 提供批量删除的确认操作
- 支持批量公式配置

## 4. 业务规则

### 4.1 指标定义规则
- 指标名称不能为空，长度限制1-50字符
- 指标编码在同一资产类型下必须唯一
- 指标分类必须从预定义选项中选择
- 指标方向必须明确指定

### 4.2 公式配置规则
- 公式必须符合语法规则和数据类型要求
- 公式中引用的变量必须存在且可访问
- 公式计算结果必须符合指标的数据类型
- 公式配置需要验证计算逻辑的正确性

### 4.3 数据来源规则
- 数据来源必须已配置并连接正常
- 数据变量必须存在于选定的数据源中
- 数据类型必须与指标类型匹配
- 数据访问权限必须验证

### 4.4 计算规则
- 计算频率必须大于等于数据采集频率
- 计算过程必须支持异常处理和错误恢复
- 计算结果必须进行数据验证和范围检查
- 计算历史必须记录和保存

### 4.5 权限控制规则
- 指标定义编辑需要管理员权限
- 公式配置需要数据管理权限
- 批量操作需要相应权限
- 权限不足时显示提示信息

## 5. 前置条件

### 5.1 系统前置条件
- 资产类型已定义并配置
- 数据源已配置并连接正常
- 动态变量已定义并可用
- 用户权限已配置

### 5.2 数据前置条件
- 指标定义已初始化
- 公式配置规则已加载
- 数据源列表已获取
- 变量列表已加载

### 5.3 用户前置条件
- 用户已登录系统
- 用户具有指标定义配置权限
- 用户具有公式配置权限
- 用户具有批量操作权限

## 6. 字段说明

### 6.1 指标定义字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| id | String | 是 | 指标唯一标识 | indicator_1234567890 |
| name | String | 是 | 指标名称 | 设备效率 |
| code | String | 是 | 指标编码 | device_efficiency |
| category | String | 是 | 指标分类 | 性能指标 |
| direction | String | 是 | 指标方向 | positive |
| unit | String | 否 | 单位 | % |
| description | String | 否 | 指标描述 | 设备运行效率指标 |
| formula | String | 是 | 计算公式 | (实际产量/理论产量)*100 |
| dataSources | Array | 是 | 数据来源列表 | ["variable_001", "variable_002"] |
| calculationFrequency | String | 是 | 计算频率 | 5分钟 |
| status | String | 是 | 指标状态 | active/inactive |
| createTime | String | 是 | 创建时间 | 2024-01-20 10:30:00 |
| createUser | String | 是 | 创建人 | admin |

### 6.2 指标分类枚举

| 分类值 | 显示名称 | 说明 | 颜色 |
|--------|----------|------|------|
| 性能指标 | 性能指标 | 设备性能相关指标 | #409EFF |
| 经济指标 | 经济指标 | 经济效益相关指标 | #67C23A |
| 安全指标 | 安全指标 | 安全监测相关指标 | #E6A23C |
| 环保指标 | 环保指标 | 环境保护相关指标 | #F56C6C |
| 质量指标 | 质量指标 | 产品质量相关指标 | #909399 |
| 能耗指标 | 能耗指标 | 能源消耗相关指标 | #9C27B0 |

### 6.3 指标方向枚举

| 方向值 | 显示名称 | 说明 | 图标 |
|--------|----------|------|------|
| positive | 正向 | 数值越大越好 | el-icon-arrow-up |
| negative | 负向 | 数值越小越好 | el-icon-arrow-down |
| neutral | 中性 | 数值在合理范围内 | el-icon-minus |

### 6.4 计算频率枚举

| 频率值 | 显示名称 | 说明 |
|--------|----------|------|
| 1分钟 | 1分钟 | 每分钟计算一次 |
| 5分钟 | 5分钟 | 每5分钟计算一次 |
| 10分钟 | 10分钟 | 每10分钟计算一次 |
| 30分钟 | 30分钟 | 每30分钟计算一次 |
| 1小时 | 1小时 | 每小时计算一次 |
| 1天 | 1天 | 每天计算一次 |

### 6.5 公式输入模式

| 模式值 | 显示名称 | 说明 | 适用场景 |
|--------|----------|------|----------|
| natural | 自然语言输入 | 使用自然语言描述计算公式 | 简单计算逻辑 |
| visual | 可视化输入 | 拖拽式公式构建界面 | 复杂计算逻辑 |
| expression | 表达式输入 | 直接输入数学表达式 | 高级用户 |

### 6.6 公式配置字段

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| inputMode | String | 是 | 输入模式 | natural/visual/expression |
| formula | String | 是 | 计算公式 | (A+B)*C/D |
| variables | Array | 是 | 变量列表 | [{name: "A", code: "var_001"}] |
| operators | Array | 否 | 运算符列表 | ["+", "-", "*", "/"] |
| functions | Array | 否 | 函数列表 | ["SUM", "AVG", "MAX"] |
| validation | Object | 否 | 验证规则 | {syntax: true, variables: true} |
| preview | Object | 否 | 预览结果 | {result: 85.5, unit: "%"} | 