<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±æ€§å˜é‡ç»„ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .toolbar {
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-box {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
            font-size: 14px;
        }

        .filter-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }

        .content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .type-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .type-static {
            background: #e3f2fd;
            color: #1976d2;
        }

        .type-business {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .type-dynamic {
            background: #e8f5e8;
            color: #388e3c;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* è¡Œå†…ç¼–è¾‘æ ·å¼ */
        .editable-row {
            background-color: #fff3cd !important;
        }

        .editable-row input,
        .editable-row select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
            background: white;
        }

        .editable-row input:focus,
        .editable-row select:focus {
            outline: none;
            border-color: #3498db;
        }

        .edit-actions {
            display: flex;
            gap: 4px;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* Drawer Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80vh;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .drawer-handle {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background-color: #ddd;
            border-radius: 2px;
            cursor: pointer;
        }

        .drawer-handle:hover {
            background-color: #bbb;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .modal-body {
            padding: 5px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #333;
            font-size: 13px;
        }

        .form-label.required::after {
            content: ' *';
            color: #e74c3c;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* åŸºæœ¬ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .group-info-section {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            background-color: #fafafa;
            display: none;
        }

        .section-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 14px;
        }

        /* Variable Management Styles */
        .variable-section {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 16px;
            margin-top: 12px;
        }

        .variable-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .variable-section-title {
            font-weight: 600;
            color: #2c3e50;
        }

        .variable-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .variable-table th,
        .variable-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        .variable-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .variable-input-control {
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
            width: 100%;
        }

        .variable-input-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .variable-actions {
            display: flex;
            gap: 4px;
        }

        .btn-icon {
            padding: 6px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            min-width: 32px;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state p {
            margin-bottom: 16px;
        }

        /* åˆ†é¡µæ§ä»¶ */
        .pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 15px 30px;
            background: white;
            border-top: 1px solid #ebeef5;
            gap: 15px;
        }

        .pagination-info {
            font-size: 14px;
            color: #606266;
        }

        .pagination-controls {
            display: flex;
            gap: 5px;
        }

        .page-btn {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            border: 1px solid #dcdfe6;
            background: white;
            color: #606266;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .page-btn:hover:not(.disabled) {
            border-color: #409eff;
            color: #409eff;
        }

        .page-btn.active {
            background-color: #409eff;
            color: white;
            border-color: #409eff;
        }

        .page-btn.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- <div class="header">
            <h1>å±æ€§å˜é‡ç»„ç®¡ç†</h1>
            <p>ç®¡ç†é™æ€å±æ€§ç»„ã€ä¸šåŠ¡å˜é‡ç»„å’ŒåŠ¨æ€å˜é‡ç»„ï¼Œæ”¯æŒå˜é‡ç»„çš„æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤å’Œå˜é‡ç®¡ç†</p>
        </div> -->

        <div class="toolbar">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢å˜é‡ç»„åç§°...">
                <div class="filter-group">
                    <select class="filter-select" id="typeFilter">
                        <option value="">å…¨éƒ¨ç±»å‹</option>
                        <option value="static">é™æ€å±æ€§ç»„</option>
                        <option value="business">ä¸šåŠ¡å˜é‡ç»„</option>
                        <option value="dynamic">åŠ¨æ€å˜é‡ç»„</option>
                    </select>
                    <select class="filter-select" id="statusFilter">
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="active">å¯ç”¨</option>
                        <option value="inactive">ç¦ç”¨</option>
                    </select>
                    <button class="btn btn-secondary" onclick="resetFilters()">é‡ç½®</button>
                </div>
            </div>
            <button class="btn btn-primary" onclick="openAddModal()">æ–°å¢å˜é‡ç»„</button>
        </div>

        <div class="content">
            <table class="table">
                <thead>
                    <tr>
                        <th>å˜é‡ç»„åç§°</th>
                        <th>æè¿°</th>
                        <th>ç±»å‹</th>
                        <th>åŒ…å«å˜é‡æ•°</th>
                        <th>æ˜¾ç¤ºé¡ºåº</th>
                        <th>çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="groupTableBody">
                    <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <div class="pagination-info">æ˜¾ç¤º 1-3 æ¡ï¼Œå…± 3 æ¡</div>
            <div class="pagination-controls">
                <button class="page-btn disabled" onclick="changePage('first')"><<</button>
                <button class="page-btn disabled" onclick="changePage('prev')"><</button>
                <button class="page-btn active" onclick="changePage(1)">1</button>
                <button class="page-btn" onclick="changePage(2)">2</button>
                <button class="page-btn" onclick="changePage(3)">3</button>
                <button class="page-btn" onclick="changePage('next')">></button>
                <button class="page-btn" onclick="changePage('last')">>></button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢/ç¼–è¾‘å˜é‡ç»„æŠ½å±‰ -->
    <div id="groupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="drawer-handle" onclick="closeModal()"></div>
                <h3 class="modal-title" id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- å˜é‡ç»„åŸºæœ¬ä¿¡æ¯ -->
                <div class="group-info-section">
                    <h4 class="section-title">åŸºæœ¬ä¿¡æ¯</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">å˜é‡ç»„ç±»å‹</label>
                            <select class="form-select" id="groupType" required>
                                <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                                <option value="static">é™æ€å±æ€§ç»„</option>
                                <option value="business">ä¸šåŠ¡å˜é‡ç»„</option>
                                <option value="dynamic">åŠ¨æ€å˜é‡ç»„</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">å˜é‡ç»„åç§°</label>
                            <input type="text" class="form-input" id="groupName" placeholder="è¯·è¾“å…¥å˜é‡ç»„åç§°" required>
                        </div>
                    </div>
                                         <div class="form-group">
                         <label class="form-label">æè¿°</label>
                         <textarea class="form-textarea" id="groupDescription" placeholder="è¯·è¾“å…¥å˜é‡ç»„æè¿°" rows="2"></textarea>
                     </div>
                </div>

                <!-- å˜é‡ç®¡ç†åŒºåŸŸ -->
                <div class="variable-section">
                    <div class="variable-section-header">
                        <h4 class="variable-section-title"></h4>
                        <button type="button" class="btn btn-primary btn-small" onclick="addVariableRow()">æ·»åŠ å˜é‡</button>
                    </div>
                    
                    <table class="variable-table" id="variableTable">
                        <thead>
                            <tr>
                                <th>å˜é‡åç§°</th>
                                <th>å˜é‡ç¼–ç </th>
                                <th>æ•°æ®ç±»å‹</th>
                                <th>ç²¾åº¦</th>
                                <th>å•ä½</th>
                                <th>åˆ†ç±»</th>
                                <th>é‡‡é›†é¢‘ç‡</th>
                                <th>æè¿°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="variableTableBody">
                            <!-- å˜é‡è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>

                    <div id="emptyVariableState" class="empty-state" style="display: none;">
                        <p>æš‚æ— å˜é‡ï¼Œç‚¹å‡»"æ·»åŠ å˜é‡"å¼€å§‹æ·»åŠ </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" onclick="saveGroup()">ä¿å­˜å˜é‡</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentMode = 'add'; // 'add' æˆ– 'edit'
        let currentGroupId = null;
        let variableCounter = 0;

        // æ¨¡æ‹Ÿæ•°æ®
        const mockGroups = [
            {
                id: 1,
                name: 'è®¾å¤‡åŸºç¡€ä¿¡æ¯',
                description: 'åŒ…å«è®¾å¤‡çš„åŸºæœ¬å±æ€§ä¿¡æ¯',
                type: 'static',
                variableCount: 5,
                displayOrder: 1,
                status: 'active',
                variables: [
                    { name: 'è®¾å¤‡åç§°', code: 'DEVICE_NAME', dataType: 'string', precision: '', unit: '', category: '', frequency: '', description: 'è®¾å¤‡çš„æ ‡å‡†åç§°' },
                    { name: 'è®¾å¤‡ç¼–ç ', code: 'DEVICE_CODE', dataType: 'string', precision: '', unit: '', category: '', frequency: '', description: 'è®¾å¤‡çš„å”¯ä¸€ç¼–ç ' },
                    { name: 'è®¾å¤‡å‹å·', code: 'DEVICE_MODEL', dataType: 'string', precision: '', unit: '', category: '', frequency: '', description: 'è®¾å¤‡çš„å‹å·è§„æ ¼' },
                    { name: 'åˆ¶é€ å•†', code: 'MANUFACTURER', dataType: 'string', precision: '', unit: '', category: '', frequency: '', description: 'è®¾å¤‡åˆ¶é€ å•†' },
                    { name: 'ç”Ÿäº§æ—¥æœŸ', code: 'PRODUCTION_DATE', dataType: 'date', precision: '', unit: '', category: '', frequency: '', description: 'è®¾å¤‡ç”Ÿäº§æ—¥æœŸ' }
                ]
            },
            {
                id: 2,
                name: 'è¿è¡ŒçŠ¶æ€å˜é‡',
                description: 'è®¾å¤‡è¿è¡Œæ—¶çš„çŠ¶æ€å˜é‡',
                type: 'dynamic',
                variableCount: 3,
                displayOrder: 2,
                status: 'active',
                variables: [
                    { name: 'è¿è¡ŒçŠ¶æ€', code: 'RUN_STATUS', dataType: 'string', precision: '', unit: '', category: 'status', frequency: '1s', description: 'è®¾å¤‡å½“å‰è¿è¡ŒçŠ¶æ€' },
                    { name: 'æ¸©åº¦', code: 'TEMPERATURE', dataType: 'number', precision: '2', unit: 'â„ƒ', category: 'realtime', frequency: '5s', description: 'è®¾å¤‡è¿è¡Œæ¸©åº¦' },
                    { name: 'è½¬é€Ÿ', code: 'RPM', dataType: 'number', precision: '0', unit: 'rpm', category: 'realtime', frequency: '1s', description: 'è®¾å¤‡è½¬é€Ÿ' }
                ]
            },
            {
                id: 3,
                name: 'ä¸šåŠ¡ç»Ÿè®¡å˜é‡',
                description: 'ä¸šåŠ¡ç›¸å…³çš„ç»Ÿè®¡å˜é‡',
                type: 'business',
                variableCount: 2,
                displayOrder: 3,
                status: 'active',
                variables: [
                    { name: 'ç´¯è®¡è¿è¡Œæ—¶é—´', code: 'TOTAL_RUNTIME', dataType: 'number', precision: '0', unit: 'å°æ—¶', category: 'cumulative', frequency: '1h', description: 'è®¾å¤‡ç´¯è®¡è¿è¡Œæ—¶é—´' },
                    { name: 'æ•ˆç‡æŒ‡æ ‡', code: 'EFFICIENCY', dataType: 'number', precision: '2', unit: '%', category: 'calculated', frequency: '1h', description: 'è®¾å¤‡è¿è¡Œæ•ˆç‡' }
                ]
            }
        ];

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            loadGroups();
            setupEventListeners();
            setupDrawerEvents();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æœç´¢åŠŸèƒ½
            document.getElementById('searchInput').addEventListener('input', function() {
                filterGroups();
            });

            // ç±»å‹ç­›é€‰
            document.getElementById('typeFilter').addEventListener('change', function() {
                filterGroups();
            });

            // çŠ¶æ€ç­›é€‰
            document.getElementById('statusFilter').addEventListener('change', function() {
                filterGroups();
            });

            // å˜é‡ç»„ç±»å‹å˜åŒ–æ—¶æ›´æ–°åˆ†ç±»é€‰é¡¹
            document.addEventListener('change', function(e) {
                if (e.target.id === 'groupType') {
                    updateVariableCategories();
                }
            });
        }

        // è®¾ç½®æŠ½å±‰æ‹–æ‹½äº‹ä»¶
        function setupDrawerEvents() {
            const modalContent = document.querySelector('.modal-content');
            
            modalContent.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
                isDragging = true;
            });

            modalContent.addEventListener('touchmove', function(e) {
                if (!isDragging) return;
                
                currentY = e.touches[0].clientY;
                const deltaY = currentY - startY;
                
                if (deltaY > 0) { // åªå…è®¸å‘ä¸‹æ‹–æ‹½
                    modalContent.style.transform = `translateY(${deltaY}px)`;
                }
            });

            modalContent.addEventListener('touchend', function(e) {
                if (!isDragging) return;
                
                const deltaY = currentY - startY;
                isDragging = false;
                
                if (deltaY > 100) { // å¦‚æœæ‹–æ‹½è·ç¦»è¶…è¿‡100pxï¼Œå…³é—­æŠ½å±‰
                    closeModal();
                } else {
                    // é‡ç½®ä½ç½®
                    modalContent.style.transform = 'translateY(0)';
                }
            });
        }

                // åŠ è½½å˜é‡ç»„åˆ—è¡¨
        function loadGroups() {
            const tbody = document.getElementById('groupTableBody');
            tbody.innerHTML = '';

            mockGroups.forEach(group => {
                const row = document.createElement('tr');
                row.setAttribute('data-group-id', group.id);
                
                const typeText = {
                    'static': 'é™æ€å±æ€§ç»„',
                    'business': 'ä¸šåŠ¡å˜é‡ç»„',
                    'dynamic': 'åŠ¨æ€å˜é‡ç»„'
                }[group.type];

                const statusText = group.status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨';
                const statusClass = group.status === 'active' ? 'status-active' : 'status-inactive';
                const typeClass = `type-${group.type}`;

                row.innerHTML = `
                    <td>${group.name}</td>
                    <td>${group.description}</td>
                    <td><span class="type-badge ${typeClass}">${typeText}</span></td>
                    <td>${group.variableCount}</td>
                    <td>${group.displayOrder}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="editGroup(${group.id})">å˜é‡ç®¡ç†</button>
                            <button class="btn btn-secondary btn-small" onclick="editRow(${group.id})">ç¼–è¾‘</button>
                            <button class="btn btn-danger btn-small" onclick="deleteGroup(${group.id})">åˆ é™¤</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ç­›é€‰å˜é‡ç»„
        function filterGroups() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            const rows = document.querySelectorAll('#groupTableBody tr');
            
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const type = row.cells[2].textContent;
                const status = row.cells[5].textContent;

                const matchesSearch = name.includes(searchTerm);
                const matchesType = !typeFilter || type.includes(typeFilter === 'static' ? 'é™æ€' : typeFilter === 'business' ? 'ä¸šåŠ¡' : 'åŠ¨æ€');
                const matchesStatus = !statusFilter || status.includes(statusFilter === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨');

                row.style.display = matchesSearch && matchesType && matchesStatus ? '' : 'none';
            });
        }

        // é‡ç½®ç­›é€‰
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('statusFilter').value = '';
            filterGroups();
        }

        // æ‰“å¼€æ–°å¢æŠ½å±‰
        function openAddModal() {
            currentMode = 'add';
            currentGroupId = null;
            document.getElementById('modalTitle').textContent = 'æ–°å¢å˜é‡ç»„';
            clearVariableTable();
            clearGroupForm();
            const modal = document.getElementById('groupModal');
            modal.style.display = 'block';
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }

        // ç¼–è¾‘å˜é‡ç»„
        function editGroup(groupId) {
            currentMode = 'edit';
            currentGroupId = groupId;
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘å˜é‡ç»„';
            
            const group = mockGroups.find(g => g.id === groupId);
            if (group) {
                loadGroupForm(group);
                loadVariables(group.variables);
            }
            
            const modal = document.getElementById('groupModal');
            modal.style.display = 'block';
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }

        // å…³é—­æŠ½å±‰
        function closeModal() {
            const modal = document.getElementById('groupModal');
            modal.classList.remove('show');
            // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—
            setTimeout(() => {
                modal.style.display = 'none';
                clearVariableTable();
                clearGroupForm();
            }, 300);
        }

        // æ¸…ç©ºå˜é‡è¡¨æ ¼
        function clearVariableTable() {
            document.getElementById('variableTableBody').innerHTML = '';
            document.getElementById('emptyVariableState').style.display = 'block';
            variableCounter = 0;
        }

        // æ¸…ç©ºåŸºæœ¬ä¿¡æ¯è¡¨å•
        function clearGroupForm() {
            document.getElementById('groupType').value = '';
            document.getElementById('groupName').value = '';
            document.getElementById('groupDescription').value = '';
        }

        // åŠ è½½åŸºæœ¬ä¿¡æ¯è¡¨å•
        function loadGroupForm(group) {
            document.getElementById('groupType').value = group.type;
            document.getElementById('groupName').value = group.name;
            document.getElementById('groupDescription').value = group.description;
        }

        // åŠ è½½å˜é‡åˆ—è¡¨
        function loadVariables(variables) {
            const tbody = document.getElementById('variableTableBody');
            tbody.innerHTML = '';
            
            if (variables && variables.length > 0) {
                variables.forEach(variable => {
                    addVariableRow(variable);
                });
                document.getElementById('emptyVariableState').style.display = 'none';
            } else {
                document.getElementById('emptyVariableState').style.display = 'block';
            }
        }

        // æ·»åŠ å˜é‡è¡Œ
        function addVariableRow(variableData = null) {
            variableCounter++;
            const tbody = document.getElementById('variableTableBody');
            const row = document.createElement('tr');
            row.id = `variable-row-${variableCounter}`;
            
            // æ ¹æ®å½“å‰æ¨¡å¼ç¡®å®šå˜é‡ç»„ç±»å‹
            let groupType = 'static'; // é»˜è®¤å€¼
            if (currentMode === 'edit' && currentGroupId) {
                const group = mockGroups.find(g => g.id === currentGroupId);
                if (group) {
                    groupType = group.type;
                }
            } else {
                // æ–°å¢æ¨¡å¼ä¸‹ï¼Œä»è¡¨å•è·å–ç±»å‹
                groupType = document.getElementById('groupType').value || 'static';
            }
            const categoryOptions = getCategoryOptions(groupType);
            
            row.innerHTML = `
                <td>
                    <input type="text" class="variable-input-control" id="var-name-${variableCounter}" 
                           placeholder="å˜é‡åç§°" value="${variableData ? variableData.name : ''}">
                </td>
                <td>
                    <input type="text" class="variable-input-control" id="var-code-${variableCounter}" 
                           placeholder="å˜é‡ç¼–ç " value="${variableData ? variableData.code : ''}">
                </td>
                <td>
                    <select class="variable-input-control" id="var-dataType-${variableCounter}">
                        <option value="">é€‰æ‹©ç±»å‹</option>
                        <option value="string" ${variableData && variableData.dataType === 'string' ? 'selected' : ''}>å­—ç¬¦ä¸²</option>
                        <option value="number" ${variableData && variableData.dataType === 'number' ? 'selected' : ''}>æ•°å€¼</option>
                        <option value="boolean" ${variableData && variableData.dataType === 'boolean' ? 'selected' : ''}>å¸ƒå°”å€¼</option>
                        <option value="date" ${variableData && variableData.dataType === 'date' ? 'selected' : ''}>æ—¥æœŸæ—¶é—´</option>
                        <option value="array" ${variableData && variableData.dataType === 'array' ? 'selected' : ''}>æ•°ç»„</option>
                        <option value="object" ${variableData && variableData.dataType === 'object' ? 'selected' : ''}>å¯¹è±¡</option>
                    </select>
                </td>
                <td>
                    <input type="number" class="variable-input-control" id="var-precision-${variableCounter}" 
                           placeholder="ç²¾åº¦" min="0" max="10" value="${variableData ? variableData.precision : ''}">
                </td>
                <td>
                    <input type="text" class="variable-input-control" id="var-unit-${variableCounter}" 
                           placeholder="å•ä½" value="${variableData ? variableData.unit : ''}">
                </td>
                <td>
                    <select class="variable-input-control" id="var-category-${variableCounter}">
                        <option value="">é€‰æ‹©åˆ†ç±»</option>
                        ${categoryOptions}
                    </select>
                </td>
                <td>
                    <select class="variable-input-control" id="var-frequency-${variableCounter}">
                        <option value="">é€‰æ‹©é¢‘ç‡</option>
                        <option value="1s" ${variableData && variableData.frequency === '1s' ? 'selected' : ''}>1ç§’</option>
                        <option value="5s" ${variableData && variableData.frequency === '5s' ? 'selected' : ''}>5ç§’</option>
                        <option value="10s" ${variableData && variableData.frequency === '10s' ? 'selected' : ''}>10ç§’</option>
                        <option value="30s" ${variableData && variableData.frequency === '30s' ? 'selected' : ''}>30ç§’</option>
                        <option value="1m" ${variableData && variableData.frequency === '1m' ? 'selected' : ''}>1åˆ†é’Ÿ</option>
                        <option value="5m" ${variableData && variableData.frequency === '5m' ? 'selected' : ''}>5åˆ†é’Ÿ</option>
                        <option value="10m" ${variableData && variableData.frequency === '10m' ? 'selected' : ''}>10åˆ†é’Ÿ</option>
                        <option value="1h" ${variableData && variableData.frequency === '1h' ? 'selected' : ''}>1å°æ—¶</option>
                        <option value="1d" ${variableData && variableData.frequency === '1d' ? 'selected' : ''}>1å¤©</option>
                        <option value="manual" ${variableData && variableData.frequency === 'manual' ? 'selected' : ''}>æ‰‹åŠ¨é‡‡é›†</option>
                    </select>
                </td>
                <td>
                    <input type="text" class="variable-input-control" id="var-description-${variableCounter}" 
                           placeholder="æè¿°" value="${variableData ? variableData.description : ''}">
                </td>
                <td>
                    <div class="variable-actions">
                        <button type="button" class="btn-icon btn-save" onclick="saveVariable(${variableCounter})">âœ“</button>
                        <button type="button" class="btn-icon btn-cancel" onclick="cancelVariable(${variableCounter})">âœ—</button>
                        <button type="button" class="btn-icon btn-delete" onclick="deleteVariable(${variableCounter})">ğŸ—‘</button>
                    </div>
                </td>
            `;
            
            tbody.appendChild(row);
            document.getElementById('emptyVariableState').style.display = 'none';
            
            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œè®¾ç½®åˆ†ç±»å€¼
            if (variableData && variableData.category) {
                document.getElementById(`var-category-${variableCounter}`).value = variableData.category;
            }
        }

        // è·å–åˆ†ç±»é€‰é¡¹
        function getCategoryOptions(groupType) {
            if (groupType === 'static') {
                return '';
            } else if (groupType === 'business') {
                return `
                    <option value="cumulative">ç´¯è®¡æ•°æ®</option>
                    <option value="calculated">è®¡ç®—æ•°æ®</option>
                `;
            } else if (groupType === 'dynamic') {
                return `
                    <option value="realtime">å®æ—¶æ•°æ®</option>
                    <option value="cumulative">ç´¯è®¡æ•°æ®</option>
                    <option value="status">çŠ¶æ€æ•°æ®</option>
                    <option value="calculated">è®¡ç®—æ•°æ®</option>
                `;
            }
            return '';
        }

        // æ›´æ–°å˜é‡åˆ†ç±»é€‰é¡¹
        function updateVariableCategories() {
            const groupType = document.getElementById('groupType').value;
            const categorySelects = document.querySelectorAll('[id^="var-category-"]');
            
            categorySelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">é€‰æ‹©åˆ†ç±»</option>' + getCategoryOptions(groupType);
                // å¦‚æœå½“å‰å€¼åœ¨æ–°çš„é€‰é¡¹ä¸­å­˜åœ¨ï¼Œåˆ™ä¿æŒé€‰ä¸­
                if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                    select.value = currentValue;
                }
            });
        }



        // ä¿å­˜å˜é‡
        function saveVariable(variableId) {
            const name = document.getElementById(`var-name-${variableId}`).value.trim();
            const code = document.getElementById(`var-code-${variableId}`).value.trim();
            const dataType = document.getElementById(`var-dataType-${variableId}`).value;
            
            if (!name) {
                alert('è¯·è¾“å…¥å˜é‡åç§°');
                return;
            }
            if (!code) {
                alert('è¯·è¾“å…¥å˜é‡ç¼–ç ');
                return;
            }
            if (!dataType) {
                alert('è¯·é€‰æ‹©æ•°æ®ç±»å‹');
                return;
            }
            
            // æ£€æŸ¥ç¼–ç å”¯ä¸€æ€§
            const allCodes = [];
            document.querySelectorAll('[id^="var-code-"]').forEach(input => {
                if (input.id !== `var-code-${variableId}`) {
                    allCodes.push(input.value.trim());
                }
            });
            
            if (allCodes.includes(code)) {
                alert('å˜é‡ç¼–ç å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨ä¸åŒçš„ç¼–ç ');
                return;
            }
            
            // ä¿å­˜æˆåŠŸï¼Œå¯ä»¥æ·»åŠ è§†è§‰åé¦ˆ
            const saveBtn = document.querySelector(`#variable-row-${variableId} .btn-save`);
            saveBtn.style.background = '#28a745';
            setTimeout(() => {
                saveBtn.style.background = '';
            }, 1000);
        }

        // å–æ¶ˆå˜é‡ç¼–è¾‘
        function cancelVariable(variableId) {
            const row = document.getElementById(`variable-row-${variableId}`);
            if (row) {
                row.remove();
                
                // å¦‚æœæ²¡æœ‰å˜é‡è¡Œäº†ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
                const tbody = document.getElementById('variableTableBody');
                if (tbody.children.length === 0) {
                    document.getElementById('emptyVariableState').style.display = 'block';
                }
            }
        }

        // åˆ é™¤å˜é‡
        function deleteVariable(variableId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå˜é‡å—ï¼Ÿ')) {
                cancelVariable(variableId);
            }
        }

        // ä¿å­˜å˜é‡ç»„
        function saveGroup() {
            // éªŒè¯åŸºæœ¬ä¿¡æ¯
            const groupType = document.getElementById('groupType').value;
            const groupName = document.getElementById('groupName').value.trim();
            const groupDescription = document.getElementById('groupDescription').value.trim();
            
            if (!groupType) {
                alert('è¯·é€‰æ‹©å˜é‡ç»„ç±»å‹');
                return;
            }
            if (!groupName) {
                alert('è¯·è¾“å…¥å˜é‡ç»„åç§°');
                return;
            }
            
            // æ”¶é›†å˜é‡æ•°æ®
            const variables = [];
            document.querySelectorAll('[id^="var-name-"]').forEach(input => {
                const variableId = input.id.split('-')[2];
                const name = input.value.trim();
                const code = document.getElementById(`var-code-${variableId}`).value.trim();
                const dataType = document.getElementById(`var-dataType-${variableId}`).value;
                const precision = document.getElementById(`var-precision-${variableId}`).value;
                const unit = document.getElementById(`var-unit-${variableId}`).value.trim();
                const category = document.getElementById(`var-category-${variableId}`).value;
                const frequency = document.getElementById(`var-frequency-${variableId}`).value;
                const description = document.getElementById(`var-description-${variableId}`).value.trim();
                
                if (name && code && dataType) {
                    variables.push({
                        name, code, dataType, precision, unit, category, frequency, description
                    });
                }
            });
            
            // æ¨¡æ‹Ÿä¿å­˜
            if (currentMode === 'add') {
                alert(`æ–°å¢å˜é‡ç»„æˆåŠŸï¼\nç±»å‹: ${groupType}\nåç§°: ${groupName}\nåŒ…å«å˜é‡: ${variables.length}ä¸ª`);
            } else {
                alert(`ç¼–è¾‘å˜é‡ç»„æˆåŠŸï¼\nç±»å‹: ${groupType}\nåç§°: ${groupName}\nåŒ…å«å˜é‡: ${variables.length}ä¸ª`);
            }
            
            closeModal();
            loadGroups(); // é‡æ–°åŠ è½½åˆ—è¡¨
        }

        // åˆ é™¤å˜é‡ç»„
        function deleteGroup(groupId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå˜é‡ç»„å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚')) {
                const group = mockGroups.find(g => g.id === groupId);
                if (group) {
                    alert(`å·²åˆ é™¤å˜é‡ç»„: ${group.name}`);
                    loadGroups(); // é‡æ–°åŠ è½½åˆ—è¡¨
                }
            }
        }

        // è¡Œå†…ç¼–è¾‘åŠŸèƒ½
        function editRow(groupId) {
            const row = document.querySelector(`tr[data-group-id="${groupId}"]`);
            if (!row) return;

            const group = mockGroups.find(g => g.id === groupId);
            if (!group) return;

            // ä¿å­˜åŸå§‹æ•°æ®
            row.dataset.originalData = JSON.stringify({
                name: group.name,
                description: group.description,
                type: group.type,
                displayOrder: group.displayOrder,
                status: group.status
            });

            // è®¾ç½®ç¼–è¾‘çŠ¶æ€
            row.classList.add('editable-row');

            // æ›¿æ¢å•å…ƒæ ¼å†…å®¹ä¸ºå¯ç¼–è¾‘æ§ä»¶
            const cells = row.cells;
            
            // åç§°åˆ—
            cells[0].innerHTML = `<input type="text" value="${group.name}" class="edit-name">`;
            
            // æè¿°åˆ—
            cells[1].innerHTML = `<input type="text" value="${group.description}" class="edit-description">`;
            
            // ç±»å‹åˆ—
            const typeOptions = {
                'static': 'é™æ€å±æ€§ç»„',
                'business': 'ä¸šåŠ¡å˜é‡ç»„',
                'dynamic': 'åŠ¨æ€å˜é‡ç»„'
            };
            const typeSelect = Object.entries(typeOptions).map(([value, text]) => 
                `<option value="${value}" ${group.type === value ? 'selected' : ''}>${text}</option>`
            ).join('');
            cells[2].innerHTML = `<select class="edit-type">${typeSelect}</select>`;
            
            // åŒ…å«å˜é‡æ•°åˆ—ï¼ˆåªè¯»ï¼‰
            cells[3].innerHTML = `<span>${group.variableCount}</span>`;
            
            // æ˜¾ç¤ºé¡ºåºåˆ—
            cells[4].innerHTML = `<input type="number" value="${group.displayOrder}" class="edit-display-order" min="1">`;
            
            // çŠ¶æ€åˆ—
            const statusOptions = [
                { value: 'active', text: 'å¯ç”¨' },
                { value: 'inactive', text: 'ç¦ç”¨' }
            ];
            const statusSelect = statusOptions.map(option => 
                `<option value="${option.value}" ${group.status === option.value ? 'selected' : ''}>${option.text}</option>`
            ).join('');
            cells[5].innerHTML = `<select class="edit-status">${statusSelect}</select>`;
            
            // æ“ä½œåˆ—
            cells[6].innerHTML = `
                <div class="edit-actions">
                    <button class="btn btn-success btn-small" onclick="saveRow(${groupId})">ä¿å­˜</button>
                    <button class="btn btn-secondary btn-small" onclick="cancelEdit(${groupId})">å–æ¶ˆ</button>
                </div>
            `;
        }

        // ä¿å­˜è¡Œç¼–è¾‘
        function saveRow(groupId) {
            const row = document.querySelector(`tr[data-group-id="${groupId}"]`);
            if (!row) return;

            // è·å–ç¼–è¾‘åçš„æ•°æ®
            const name = row.querySelector('.edit-name').value.trim();
            const description = row.querySelector('.edit-description').value.trim();
            const type = row.querySelector('.edit-type').value;
            const displayOrder = parseInt(row.querySelector('.edit-display-order').value);
            const status = row.querySelector('.edit-status').value;

            // éªŒè¯æ•°æ®
            if (!name) {
                alert('è¯·è¾“å…¥å˜é‡ç»„åç§°');
                return;
            }
            if (displayOrder < 1) {
                alert('æ˜¾ç¤ºé¡ºåºå¿…é¡»å¤§äº0');
                return;
            }

            // æ›´æ–°æ¨¡æ‹Ÿæ•°æ®
            const groupIndex = mockGroups.findIndex(g => g.id === groupId);
            if (groupIndex !== -1) {
                mockGroups[groupIndex] = {
                    ...mockGroups[groupIndex],
                    name,
                    description,
                    type,
                    displayOrder,
                    status
                };
            }

            // é€€å‡ºç¼–è¾‘çŠ¶æ€
            exitEditMode(row);
            
            // é‡æ–°åŠ è½½åˆ—è¡¨ä»¥æ˜¾ç¤ºæ›´æ–°åçš„æ•°æ®
            loadGroups();
            
            alert('ä¿å­˜æˆåŠŸï¼');
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit(groupId) {
            const row = document.querySelector(`tr[data-group-id="${groupId}"]`);
            if (!row) return;

            // æ¢å¤åŸå§‹æ•°æ®
            const originalData = JSON.parse(row.dataset.originalData || '{}');
            const groupIndex = mockGroups.findIndex(g => g.id === groupId);
            if (groupIndex !== -1 && originalData.name) {
                mockGroups[groupIndex] = {
                    ...mockGroups[groupIndex],
                    ...originalData
                };
            }

            // é€€å‡ºç¼–è¾‘çŠ¶æ€
            exitEditMode(row);
            
            // é‡æ–°åŠ è½½åˆ—è¡¨
            loadGroups();
        }

        // é€€å‡ºç¼–è¾‘æ¨¡å¼
        function exitEditMode(row) {
            row.classList.remove('editable-row');
            delete row.dataset.originalData;
        }

        // åˆ†é¡µåŠŸèƒ½
        function changePage(page) {
            // è¿™é‡Œå¯ä»¥å®ç°åˆ†é¡µé€»è¾‘
            console.log('å¯¼èˆªåˆ°ç¬¬' + page + 'é¡µå˜é‡ç»„åˆ—è¡¨');
            
            // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
            const pageButtons = document.querySelectorAll('.pagination-controls .page-btn');
            pageButtons.forEach(btn => {
                btn.classList.remove('active', 'disabled');
            });
            
            // æ ¹æ®é¡µé¢è®¾ç½®æ´»åŠ¨çŠ¶æ€
            if (page === 1) {
                pageButtons[2].classList.add('active'); // ç¬¬1é¡µæŒ‰é’®
                pageButtons[0].classList.add('disabled'); // é¦–é¡µæŒ‰é’®
                pageButtons[1].classList.add('disabled'); // ä¸Šä¸€é¡µæŒ‰é’®
            } else if (page === 2) {
                pageButtons[3].classList.add('active'); // ç¬¬2é¡µæŒ‰é’®
            } else if (page === 3) {
                pageButtons[4].classList.add('active'); // ç¬¬3é¡µæŒ‰é’®
                pageButtons[5].classList.add('disabled'); // ä¸‹ä¸€é¡µæŒ‰é’®
                pageButtons[6].classList.add('disabled'); // æœ«é¡µæŒ‰é’®
            }
        }

        // ç‚¹å‡»æŠ½å±‰å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('groupModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // è§¦æ‘¸æ‹–æ‹½å…³é—­åŠŸèƒ½
        let startY = 0;
        let currentY = 0;
        let isDragging = false;
    </script>
</body>
</html> 